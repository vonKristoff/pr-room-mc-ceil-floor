{"version":3,"file":"bundle.js","sources":["../js/main.js"],"sourcesContent":["let scene, camera, renderer, controls, dolly\nlet loader = new THREE.GLTFLoader();\nlet hasLoaded = false\nlet panels = []\nlet pivots = []\nconst walls = ['ROOM', 'FLOOR2', 'MC2']\n\nlet target = { position: { x: 0, y: 0, z: 0 } }\nlet t2 = { position: { x: 0, y: 0, z: 0 } }\nlet pics = []\nlet moveCamera\nwindow.addEventListener('keyup', (e) => {\n  console.log(e.keyCode)\n  if (e.keyCode === 32) moveCamera()\n  if (e.keyCode === 13) exit()\n  if (e.keyCode === 49) togglePanels('N')\n  if (e.keyCode === 50) togglePanels('1')\n  if (e.keyCode === 51) togglePanels('2')\n  if (e.keyCode === 52) togglePanels('W')\n})\nconst backpanels = ['SL2B', 'SR2B', 'SL1B', 'SR1B']\nfunction loadModels(wall, i) {\n  loader.load(`./model/${wall}/${wall}.gltf`, function (gltf) {\n    // let car = gltf.scene.children[0]\n    // const a = car.children[0]\n    // // car.geometry.center(); // center here\n    // let t = car.children[0]\n    // console.log(gltf)\n    // console.log(a.children[0], gltf.scene)\n    // scene.add(gltf.scene);\n    gltf.scene.traverse(function (child) {\n      // console.log(child.name)\n\n      const descriptors = child.name.split('_')\n      if (descriptors.some((part) => part === 'Slice')) {\n        child.material.depthTest = false\n        child.material.depthWrite = false\n        // child.material.depthFunc = THREE.GreaterDepth\n        // child.material.blending = THREE.SubtractiveBlending\n      }\n\n      if (descriptors.some((part) => part === 'PIVOT')) {\n        if (descriptors.some((part) => part === 'PANEL')) {\n          if (descriptors.some((part) => part === 'LEFT')) {\n            child.userData.toggle = swing(child, 'left')\n            panels.push(child)\n          }\n          if (descriptors.some((part) => part === 'RIGHT')) {\n            child.userData.toggle = swing(child, 'right')\n            panels.push(child)\n          }\n        }\n      }\n\n\n\n\n      if (child.isMesh) child.material.transparent = true\n      if (descriptors.some((part) => part === 'TARGET')) {\n        // const EAST = child.parent.name.split('_').some(part => part === 'EAST')\n        if (child.hasOwnProperty('material')) child.material.opacity = 0\n        // if (EAST) {\n        //   child.userData.axis = ['y', 'z']\n        //   child.userData.c = 'x'\n        // }\n        // else {\n        //   child.userData.axis = ['x', 'y']\n        //   child.userData.c = 'z'\n        // }\n        // console.log('TARGET', child.name, child.hasOwnProperty('material'))\n\n        pics.push(child)\n        // if (Math.round(Math.random())) \n      }\n      // if (child.name === 'PIVOT_PANEL_N_RIGHT') {\n      //   // child.rotation.z = -Math.PI / 5\n      //   child.userData.toggle = swing(child, 'right')\n      //   panels.push(child)\n      // }\n      // if (child.name === 'PIVOT_PANEL_S_RIGHT') {\n      //   // child.rotation.z = -Math.PI / 5\n      //   child.userData.toggle = swing(child, 'right')\n      //   panels.push(child)\n      // }\n      // if (child.name === 'PIVOT_PANEL_N_LEFT') {\n      //   // child.rotation.z = -Math.PI / 5\n      //   child.userData.toggle = swing(child, 'left')\n      //   panels.push(child)\n      // }\n      // if (child.name === 'TARGET_P51') {\n      //   console.log(' PICTURE TARGET', child)\n      //   target = { position: child.getWorldPosition() }\n      // }\n      // if (child.name === 'TARGET_P53') {\n      //   console.log(' PICTURE TARGET', child)\n      //   t2 = { position: child.getWorldPosition() }\n      // }\n\n      // if (child.name === 'PIVOT_NORTH_WALL') {\n      //   child.position.z = 2.125\n      //   child.children[1]\n      // }\n      // if (child.name === 'PIVOT_EAST_WALL') {\n      //   const d = child.children[0].children[3].material\n      //   d.depthWrite = false\n      //   d.depthTest = false\n      //   d.depthFunc = THREE.NeverDepth\n      //   // d.opacity = .25\n      //   // console.log(d)\n      //   child.position.x = -2.125\n\n      //   // console.log('world direction of', child.getWorldDirection(new THREE.Vector3()))\n      //   // console.log('distance to', child.distanceTo(dolly))\n\n      // }\n    });\n\n\n    gltf.scene.scale.set(1, 1, 1) // scale here\n    scene.add(gltf.scene)\n    ready()\n    hasLoaded = true\n  });\n}\nfunction ready() {\n  if (hasLoaded) return\n  animate()\n  // setTimeout(() => {\n  //   pics.sort(() => (Math.random() > .5) ? 1 : -1)\n  //   pics.forEach(tgt => {\n  //     console.log(tgt.name)\n  //   })\n  //   let pos = pics.map(p => {\n  //     const [a, b] = p.userData.axis\n  //     const target = p.getWorldPosition()\n  //     return {\n  //       dolly: target,\n  //       camera: { [a]: target[a], [b]: target[b], [p.userData.c]: 0 }\n  //     }\n  //   })\n  //   // dolly.material.opacity = 0.25\n  //   moveCamera = slide(camera, createTour(pos))//[target.position, { x: 1, y: -1 }, { x: 0, y: 0 }]))\n  // }, 3000)\n}\n\nlet adjacent\n\nfunction init() {\n\n  scene = new THREE.Scene();\n  renderer = new THREE.WebGLRenderer({ antialias: true });\n  renderer.setSize(window.innerWidth, window.innerHeight);\n  renderer.gammaOutput = true;\n  renderer.gammaFactor = 2.2;\n  // renderer.context.disable(renderer.context.DEPTH_TEST);\n  document.body.appendChild(renderer.domElement);\n\n  camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 5000);\n  controls = new THREE.OrbitControls(camera, renderer.domElement)\n\n  let hlight = new THREE.AmbientLight('white');\n\n  const boxGeom = new THREE.BoxGeometry(.25, .25, .25);\n  const material = new THREE.MeshBasicMaterial({ color: 'red', side: THREE.FrontSide });\n  dolly = new THREE.Object3D()//new THREE.Mesh(boxGeom, material) \n\n  // dolly.material.opacity = 0\n  console.log(dolly)\n  // dolly.visible = false\n  adjacent = new THREE.Mesh(boxGeom, material)\n  // adjacent.position.set(2.5, 0, -2.5)\n  scene.add(dolly)\n  scene.add(hlight);\n\n  console.log('DOLLY', dolly)\n\n  // camera.lookAt(dolly)\n  camera.position.set(2 * Math.PI, 0, -2.5);\n\n  walls.forEach(loadModels)\n}\n\nlet z = 0\n\nfunction animate() {\n  controls.update()\n  camera.lookAt(dolly.position)\n  // z += 0.05\n  // target.rotation.z = z\n  TWEEN.update()\n  renderer.render(scene, camera);\n  requestAnimationFrame(animate);\n}\ninit();\n\nfunction createTour(sequence) {\n  let index = 0\n  return {\n    next: () => sequence[index],\n    update: () => index++\n  }\n}\n\nfunction slide(p, state) {\n\n  return () => {\n    new TWEEN.Tween(dolly.position)\n      .to(state.next().dolly, 2000)\n      // .delay(500)\n      .easing(TWEEN.Easing.Cubic.Out)\n      .start()\n\n    new TWEEN.Tween(camera.position)\n      .to(state.next().camera, 2000)\n      .easing(TWEEN.Easing.Cubic.Out)\n      .onComplete(() => {\n        state.update()\n      })\n      .start()\n\n    // new TWEEN.Tween(camera.scale)\n    //   .to({ z: 2 }, 1500)\n    //   .delay(1500)\n    //   .easing(TWEEN.Easing.Cubic.Out)\n    //   .start()\n  }\n}\n\nfunction togglePanels(group) {\n  panels.forEach(door => {\n    const parts = door.name.split('_')\n    const match = parts.some((part) => part === group)\n    if (match) door.userData.toggle()\n  })\n}\n\nfunction exit() {\n  new TWEEN.Tween(dolly.position)\n    .to({ x: 0, y: 0, z: 0 }, 1000)\n    .easing(TWEEN.Easing.Cubic.Out)\n    .start()\n\n  new TWEEN.Tween(camera.position)\n    .to({ x: 0, y: 0, z: -2.50 }, 2000)\n    .easing(TWEEN.Easing.Cubic.Out)\n    .onComplete(() => {\n      camera.position.set(0, 0, -2.5);\n    })\n    .start()\n}\n\nfunction swing(pivot, align) {\n  const to = align === 'right' ? -Math.PI / 2.2 : Math.PI / 2.2\n  return toggler(pivot, to)\n}\n\nfunction toggler(pivot, to) {\n  let open = true\n  return () => {\n    if (open) twist('z', pivot, to)\n    else twist('z', pivot, 0)\n    open = !open\n  }\n}\n\nfunction twist(axis, p, target = 0) {\n  new TWEEN.Tween(p.rotation)\n    .to({ [axis]: target }, 2000)\n    .easing(TWEEN.Easing.Cubic.Out)\n    .onUpdate(({ y }) => {\n      if (target !== 0) {\n        // close\n        // if (y >= Math.PI) {\n        //   p.userData.material.visible = false\n        //   p.userData.material.needsUpdate = true;\n        // }\n        // if (y <= -Math.PI) {\n        //   p.userData.material.visible = false\n        //   p.userData.material.needsUpdate = true;\n        // }\n      } else {\n        // p.userData.material.visible = true\n        // p.userData.material.needsUpdate = true;\n      }\n    })\n    .start()\n}"],"names":["let","const"],"mappings":"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"}